const fs = require('fs');
const path = require('path');

function scanDirectory(dirPath, basePath = '') {
  const items = fs.readdirSync(dirPath, { withFileTypes: true });
  const files = {};
  const directories = {};
  
  items.forEach(item => {
    if (item.name.startsWith('.')) return; // Skip hidden files
    
    const itemPath = path.join(dirPath, item.name);
    const relativePath = path.join(basePath, item.name);
    
    if (item.isDirectory()) {
      directories[item.name] = scanDirectory(itemPath, relativePath);
    } else if (item.isFile() && (item.name.endsWith('.md') || item.name.endsWith('.pdf'))) {
      files[item.name] = `/resources/${relativePath}`;
    }
  });
  
  // Return with files first, then directories
  return { ...files, ...directories };
}

// Generate the file structure
const resourcesPath = path.join(__dirname, '..', 'resources');
const fileStructure = scanDirectory(resourcesPath);

// Create the output
const output = `// This file is auto-generated by scripts/generate-file-structure.js
// Do not edit manually - run 'npm run generate-files' to update

export const fileStructure = ${JSON.stringify(fileStructure, null, 2)};

export const defaultExpandedFolders = ${JSON.stringify(
  Object.keys(fileStructure).filter(key => typeof fileStructure[key] === 'object'),
  null,
  2
)};
`;

// Write to file
const outputPath = path.join(__dirname, '..', 'src', 'fileStructure.js');
fs.writeFileSync(outputPath, output);

console.log('âœ“ File structure generated successfully');
console.log(`  Found ${Object.keys(fileStructure).length} items`);